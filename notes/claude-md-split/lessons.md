# 学習ノート: CLAUDE.md分割

## タスク概要
- 日時: 2025-02-05
- コミット: 6ffcd15
- 変更ファイル数: 14

## 検出されたミス・手戻り

### 1. Worker-2のハング（10分間停止）
- **発生**: Worker-2がファイル読み込み後にPhotosynthesizing状態で10分停止
- **原因**: 不明（Claude Codeの内部状態の問題の可能性）
- **対処**: Escキーで割り込み、タスク再実行を指示
- **教訓**: Worker監視とタイムアウト検知の自動化が必要

### 2. 影響調査の事前不足
- **発生**: CLAUDE.md分割後に影響調査を実施
- **問題**: 分割を実行してから影響を調査した（順序が逆）
- **教訓**: 構造変更は影響調査を先に行うべき

## 効率化ポイント

### 1. テンプレートと実ファイルの二重管理
- `.claude/` と `src/ensemble/templates/` の両方に同じファイルが存在
- 変更時は常に両方を更新する必要がある
- **改善案**: 自動同期スクリプト or テンプレートからの自動生成

### 2. pathsの不採用判断
- `.claude/rules/` の `paths` 機能を検討したが不採用
- 理由: Ensembleはマルチエージェントシステムで、ルールの常時参照が必要
- **結果**: 可読性向上のみ、コンテキスト軽量化は限定的（約14%）

## 成功パターン

### 1. 並列Worker実行
- 2 Workerで6ファイルを分担（各3ファイル）
- Worker-1: 実ファイル、Worker-2: テンプレート
- 依存関係なしで並列実行可能

### 2. 影響調査の網羅性
- `grep` で全参照箇所を特定
- CLAUDE.md参照: 50件以上
- 学習済みルール参照: 12件
- 漏れなく修正対象を特定できた
